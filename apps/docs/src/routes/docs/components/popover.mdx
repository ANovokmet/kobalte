import { Preview, TabsSnippets, Kbd, Callout } from "../../../components";
import { BasicExample, ControlledExample } from "../../../examples/popover";

# Popover

A popover positioned relative to an anchor element.

## Import

```ts
import { Popover } from "@kobalte/core";
```

## Features

- Follow the [WAI ARIA Popover](https://www.w3.org/WAI/ARIA/apg/patterns/popovermodal/) design pattern.
- Supports modal and non-modal modes.
- Hide the content outside the popover from assistive technologies while it is open, in the modal mode.
- Provides screen reader announcements via rendered title and description.
- Focus is fully managed and customizable.
- Optionally render a pointing arrow.
- Customize side, alignment, offsets.
- Can be controlled or uncontrolled.

## Anatomy

The popover consists of:

- **Popover:** The root container for a popover.
- **Popover.Trigger:** The button that opens the popover.
- **Popover.Anchor:** An optional element to position the `Popover.Content` against.
- **Popover.Portal:** Portals its children into the `body` when the popover is open.
- **Popover.Positioner:** A wrapper component to help positioning the popover content on screen.
- **Popover.Content:** Contains the content to be rendered when the popover is open.
- **Popover.Arrow:** An optional arrow element to render alongside the popover.
- **Popover.CloseButton:** The button that closes the popover.
- **Popover.Title:** An accessible title to be announced when the popover is open.
- **Popover.Description:** An optional accessible description to be announced when the popover is open.

```tsx
<Popover>
  <Popover.Trigger />
  <Popover.Anchor />
  <Popover.Portal>
    <Popover.Positioner>
      <Popover.Content>
        <Popover.Arrow />
        <Popover.CloseButton />
        <Popover.Title />
        <Popover.Description />
      </Popover.Content>
    </Popover.Positioner>
  </Popover.Portal>
</Popover>
```

## Example

<Preview>
  <BasicExample />
</Preview>

## Usage

### Default open

An initial, uncontrolled value can be provided using the `defaultIsOpen` prop.

```tsx
<Popover defaultIsOpen>...</Popover>
```

### Controlled open

The `isOpen` prop can be used to make the open state controlled. The `onOpenChange` event is fired when the user presses the trigger, close button or interact outside, and receives the new value.

<Preview>
  <ControlledExample />
</Preview>

## API Reference

### Popover

| Prop                         | Description                                                                                                                                                                                                                                                                                                                                                |
| :--------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| isOpen                       | `boolean` <br/> The controlled open state of the popover.                                                                                                                                                                                                                                                                                                  |
| defaultIsOpen                | `boolean` <br/> The default open state when initially rendered. Useful when you do not need to control the open state.                                                                                                                                                                                                                                     |
| onOpenChange                 | `(isOpen: boolean) => void` <br/> Event handler called when the open state of the popover changes.                                                                                                                                                                                                                                                         |
| id                           | `string` <br/> A unique identifier for the component. The id is used to generate id attributes for nested components. If no id prop is provided, a generated id will be used.                                                                                                                                                                              |
| forceMount                   | `boolean` <br/> Used to force mounting the popover (portal, positioner and content) when more control is needed. Useful when controlling animation with SolidJS animation libraries.                                                                                                                                                                       |
| isModal                      | `boolean` <br/> Whether the popover should be the only visible content for screen readers.                                                                                                                                                                                                                                                                 |
| preventScroll                | `boolean` <br/> Whether the scroll should be locked when the popover is open.                                                                                                                                                                                                                                                                              |
| closeOnEsc                   | `boolean` <br/> Whether pressing the escape key should close the popover.                                                                                                                                                                                                                                                                                  |
| closeOnInteractOutside       | `boolean` <br/> Whether to close the popover when the user interacts outside it.                                                                                                                                                                                                                                                                           |
| shouldCloseOnInteractOutside | `(element: Element) => boolean` <br/> When user interacts with the argument element outside the popover content, return `true` if the popover should be closed. This gives you a chance to filter out interaction with elements that should not dismiss the popover. By default, the popover will always close on interaction outside the popover content. |
| trapFocus                    | `boolean` <br/> Whether focus should be locked inside the popover content.                                                                                                                                                                                                                                                                                 |
| autoFocus                    | `boolean \| string` <br/> Whether focus should be set on a child element once the popover is open. If `true` focus will be set to the first focusable element inside the popover content. If a `string` (query selector) is provided focus will be set to the target element.                                                                              |
| restoreFocus                 | `boolean \| string` <br/> Whether focus should be restored once the popover close. If `true` focus will be restored to the element that triggered the popover. If a `string` (query selector) is provided focus will be restored to the target element.                                                                                                    |
| getAnchorRect                | `(anchor?: HTMLElement) => AnchorRect  \| undefined` <br/> Function that returns the anchor element's DOMRect.                                                                                                                                                                                                                                             |
| anchorRef                    | `Accessor<HTMLElement \| undefined>` <br/> A ref for the anchor element. Useful if you want to use an element outside `Popover` as the popover anchor.                                                                                                                                                                                                     |
| placement                    | `Placement` <br/> The placement of the popover.                                                                                                                                                                                                                                                                                                            |
| gutter                       | `number` <br/> The distance between the popover and the trigger/anchor element. By default, it's 0 plus half of the arrow offset, if it exists.                                                                                                                                                                                                            |
| shift                        | `number` <br/> The skidding of the popover along the anchor element.                                                                                                                                                                                                                                                                                       |
| flip                         | `boolean \| string` <br/> Controls the behavior of the popover when it overflows the viewport: If a `boolean`, specifies whether the popover should flip to the opposite side when it overflows. If a `string`, indicates the preferred fallback placements when it overflows. The placements must be spaced-delimited, e.g. "top left".                   |
| slide                        | `boolean` <br/> Whether the popover should slide when it overflows.                                                                                                                                                                                                                                                                                        |
| overlap                      | `boolean` <br/> Whether the popover can overlap the anchor element when it overflows.                                                                                                                                                                                                                                                                      |
| sameWidth                    | `boolean` <br/> Whether the popover should have the same width as the anchor element. This will be exposed to CSS as `--kb-popover-anchor-width`.                                                                                                                                                                                                          |
| fitViewport                  | `boolean` <br/> Whether the popover should fit the viewport. If this is set to true, the popover positioner will have `maxWidth` and `maxHeight` set to the viewport size. This will be exposed to CSS as `--kb-popover-available-width` and `--kb-popover-available-height`.                                                                              |
| hideWhenDetached             | `boolean` <br/> Whether to hide the popover when the anchor element becomes occluded.                                                                                                                                                                                                                                                                      |
| detachedPadding              | `number` <br/> The minimum padding in order to consider the anchor element occluded.                                                                                                                                                                                                                                                                       |
| arrowPadding                 | `number` <br/> The minimum padding between the arrow and the popover corner.                                                                                                                                                                                                                                                                               |
| overflowPadding              | `number` <br/> The minimum padding between the popover and the viewport edge. This will be exposed to CSS as `--kb-popover-overflow-padding`.                                                                                                                                                                                                              |

### Popover.Trigger

| Data attribute | Description                       |
| :------------- | :-------------------------------- |
| data-expanded  | Present when the popover is open. |

### Popover.Arrow

| Prop | Description                           |
| :--- | :------------------------------------ |
| size | `number` <br/> The size of the arrow. |

## Accessibility

### Keyboard Interactions

| Key                               | Description                                                                      |
| :-------------------------------- | :------------------------------------------------------------------------------- |
| <Kbd>Space</Kbd>                  | When focus is on the trigger, opens/closes the popover.                          |
| <Kbd>Enter</Kbd>                  | When focus is on the trigger, opens/closes the popover.                          |
| <Kbd>Tab</Kbd>                    | When focus is in the content, moves focus to the next focusable element.         |
| <Kbd>Shift</Kbd> + <Kbd>Tab</Kbd> | When focus is in the content, moves focus to the next previous element.          |
| <Kbd>Esc</Kbd>                    | When focus is in the content, closes the popover and moves focus to the trigger. |
