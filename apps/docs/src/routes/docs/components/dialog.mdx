import { Preview, Kbd, Callout } from "../../../components";
import { BasicExample, ControlledExample } from "../../../examples/dialog";

# Dialog

A window overlaid on either the primary window or another dialog window. Content behind a modal dialog is inert, meaning that users cannot interact with it.

## Import

```ts
import { Dialog } from "@kobalte/core";
```

## Features

- Follow the [WAI ARIA Dialog](https://www.w3.org/WAI/ARIA/apg/patterns/dialogmodal/) design pattern.
- Supports modal and non-modal modes.
- Hide the content outside the dialog from assistive technologies while it is open, in the modal mode.
- Provides screen reader announcements via rendered title and description.
- Focus is trapped and scrolling is blocked while it is open.
- Pressing <Kbd>Esc</Kbd> closes the dialog.
- Can be controlled or uncontrolled.

## Anatomy

The dialog consists of:

- **Dialog:** Contains all the parts of a dialog.
- **Dialog.Trigger:** The button that opens the dialog.
- **Dialog.Portal:** Portals its children into the `body` when the dialog is open.
- **Dialog.Overlay:** The layer that covers the inert portion of the view when the dialog is open.
- **Dialog.Positioner:** A wrapper component to help positioning the dialog panel on screen.
- **Dialog.Content:** Contains the content to be rendered when the dialog is open.
- **Dialog.CloseButton:** The button that closes the dialog.
- **Dialog.Title:** An accessible title to be announced when the dialog is opened.
- **Dialog.Description:** An optional accessible description to be announced when the dialog is opened.

```tsx
<Dialog>
  <Dialog.Trigger />
  <Dialog.Portal>
    <Dialog.Overlay />
    <Dialog.Positioner>
      <Dialog.Content>
        <Dialog.CloseButton />
        <Dialog.Title />
        <Dialog.Description />
      </Dialog.Content>
    </Dialog.Positioner>
  </Dialog.Portal>
</Dialog>
```

## Example

<Preview>
  <BasicExample />
</Preview>

```tsx
import { Dialog as DialogBase } from "@kobalte/core";
import { ComponentProps } from "solid-js";
import { CrossIcon } from "some-icon-library";

function Dialog(props: ComponentProps<typeof DialogBase>) {
  return <DialogBase {...props} />;
}

function DialogTrigger(props: ComponentProps<typeof DialogBase.Trigger>) {
  return (
    <DialogBase.Trigger
      class="appearance-none outline-none h-10 px-4 rounded-md text-white bg-blue-600 dark:text-white/90 disabled:opacity-40 focus:ring focus:ring-blue-200 dark:focus:ring-blue-500/30"
      {...props}
    />
  );
}

// Abstracts the Dialog.Portal, Dialog.Overlay and Dialog.Positioner parts.
function DialogContent(props: ComponentProps<typeof DialogBase.Content>) {
  return (
    <DialogBase.Portal>
      <DialogBase.Overlay class="z-50 fixed inset-0 bg-black/20" />
      <DialogBase.Positioner class="z-50 fixed inset-0 flex items-center justify-center">
        <DialogBase.Content
          class="relative bg-white rounded-lg shadow dark:bg-zinc-700"
          {...props}
        ></DialogBase.Content>
      </DialogBase.Positioner>
    </DialogBase.Portal>
  );
}

function DialogTitle(props: ComponentProps<typeof DialogBase.Title>) {
  return (
    <DialogBase.Title class="text-xl font-semibold text-zinc-900 dark:text-white" {...props} />
  );
}

function DialogCloseButton(props: ComponentProps<typeof DialogBase.CloseButton>) {
  return (
    <DialogBase.CloseButton
      aria-label="Close dialog"
      class="text-zinc-400 bg-transparent hover:bg-zinc-200 hover:text-zinc-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center dark:hover:bg-zinc-600 dark:hover:text-white"
      {...props}
    >
      <CrossIcon class="w-4 h-4" />
    </DialogBase.CloseButton>
  );
}

function App() {
  return (
    <Dialog>
      <DialogTrigger>Open dialog</DialogTrigger>
      <DialogContent>
        <div class="flex items-start justify-between p-4 border-b rounded-t dark:border-zinc-600">
          <DialogTitle>About Kobalte</DialogTitle>
          <DialogCloseButton />
        </div>
        <div class="p-6 space-y-6 max-w-lg">
          <p class="text-base leading-relaxed text-zinc-500 dark:text-zinc-400">
            Kobalte is a UI toolkit for building accessible web apps and design systems with
            SolidJS. It provides a set of low-level UI components and primitives which can be the
            foundation for your design system implementation.
          </p>
        </div>
        <div class="flex items-center justify-end p-4 border-t border-zinc-200 rounded-b dark:border-zinc-600">
          <button
            id="ok-button"
            type="button"
            class="appearance-none outline-none h-10 px-4 rounded-md text-white bg-blue-600 dark:text-white/90 disabled:opacity-40 focus:ring focus:ring-blue-200 dark:focus:ring-blue-500/30"
          >
            OK
          </button>
        </div>
      </DialogContent>
    </Dialog>
  );
}
```

## Usage

The following examples show how to use the `Dialog` components created in the above example.

### Default open state

Dialog is not open by default. The `defaultIsOpen` prop can be used to set the default state.

```tsx
<Dialog defaultIsOpen>...</Dialog>
```

### Controlled open state

The `isOpen` prop can be used to make the open state controlled. The `onOpenChange` event is fired when the user presses the trigger, close button or overlay, and receives the new value.

<Preview>
  <ControlledExample />
</Preview>

```tsx {3,7}
import { createSignal } from "solid-js";

function ControlledExample() {
  const [open, setOpen] = createSignal(false);

  return (
    <>
      <Dialog isOpen={open()} onOpenChange={setOpen}>
        ...
      </Dialog>
      <p>The dialog is {open() ? "opened" : "closed"}.</p>
    </>
  );
}
```

### Modal mode

By default, Dialog is the only visible content for screen readers and hides everything behind it from assistive technologies.

Although it's not recommended, you can set the `isModal` prop to `false` to disabled this behavior.

<Preview>
  <BasicExample isModal={false} />
</Preview>

```tsx
<Dialog isModal={false}>...</Dialog>
```

<Callout type="note">
  <span>If you inspect the DOM you will see that no element has the `aria-hidden` attribute.</span>
</Callout>

### Prevent scroll

Set the `preventScroll` prop to `false` to prevent the dialog from blocking the scroll when open.

<Preview>
  <BasicExample preventScroll={false} />
</Preview>

```tsx
<Dialog preventScroll={false}>...</Dialog>
```

### Close on escape

Dialog closes when the `Esc` key is pressed, setting the `closeOnEsc` prop to `false` disables this behavior.

<Preview>
  <BasicExample closeOnEsc={false} />
</Preview>

```tsx
<Dialog closeOnEsc={false}>...</Dialog>
```

### Close on interact outside

Set the `closeOnInteractOutside` prop to `false` to prevent the dialog to be closed when the user interact outside it.

<Preview>
  <BasicExample closeOnInteractOutside={false} />
</Preview>

```tsx
<Dialog closeOnInteractOutside={false}>...</Dialog>
```

## Focus management

### Trap focus

By default, focus is locked inside the dialog when open. Although it's not recommended, you can set the `trapFocus` prop to `false` to disabled this behavior.

<Preview>
  <BasicExample trapFocus={false} />
</Preview>

```tsx
<Dialog trapFocus={false}>...</Dialog>
```

### Auto focus

Set the `autoFocus` prop to `true` or any CSS selector to focus the target element when the dialog open. If set to `true`, focus will be on the first focusable element inside the dialog content or fallback to the content itself.

<Preview>
  <BasicExample autoFocus="#ok-button" />
</Preview>

```tsx
<Dialog autoFocus="#ok-button">...</Dialog>
```

### Restore focus

Set the `restoreFocus` prop to `true` or any CSS selector to restore focus when the dialog close. If set to `true`, focus will be restored to the dialog trigger element when the dialog closes unless another focusable element has taken focus.

<Preview>
  <div class="flex items-center space-x-2">
    <BasicExample restoreFocus="#restore-focus-target" />
    <button
      id="restore-focus-target"
      type="button"
      class="appearance-none outline-none h-10 px-4 rounded-md text-white bg-blue-600 dark:text-white/90 disabled:opacity-40 focus:ring focus:ring-blue-200 dark:focus:ring-blue-500/30"
    >
      Restore focus target
    </button>
  </div>
</Preview>

```tsx
  <Dialog restoreFocus="#restore-focus-target">...</Dialog>
  <button id="restore-focus-target">Restore focus target</button>
```

## API Reference

### Dialog

| Prop                         | Description                                                                                                                                                                                                                                                                                                                                           |
| :--------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| isOpen                       | `boolean` <br/> The controlled open state of the dialog.                                                                                                                                                                                                                                                                                              |
| defaultIsOpen                | `boolean` <br/> The default open state when initially rendered. Useful when you do not need to control the open state.                                                                                                                                                                                                                                |
| onOpenChange                 | `(isOpen: boolean) => void` <br/> Event handler called when the open state of the dialog changes.                                                                                                                                                                                                                                                     |
| id                           | `string` <br/> A unique identifier for the component. The id is used to generate id attributes for nested components. If no id prop is provided, a generated id will be used.                                                                                                                                                                         |
| forceMount                   | `boolean` <br/> Used to force mounting the dialog (portal, overlay, positioner and content) when more control is needed. Useful when controlling animation with SolidJS animation libraries.                                                                                                                                                          |
| isModal                      | `boolean` <br/> Whether the dialog should be the only visible content for screen readers.                                                                                                                                                                                                                                                             |
| preventScroll                | `boolean` <br/> Whether the scroll should be locked when the dialog is open.                                                                                                                                                                                                                                                                          |
| closeOnEsc                   | `boolean` <br/> Whether pressing the escape key should close the dialog.                                                                                                                                                                                                                                                                              |
| closeOnInteractOutside       | `boolean` <br/> Whether to close the dialog when the user interacts outside it.                                                                                                                                                                                                                                                                       |
| shouldCloseOnInteractOutside | `(element: Element) => boolean` <br/> When user interacts with the argument element outside the dialog content, return `true` if the dialog should be closed. This gives you a chance to filter out interaction with elements that should not dismiss the dialog. By default, the dialog will always close on interaction outside the dialog content. |
| trapFocus                    | `boolean` <br/> Whether focus should be locked inside the dialog content.                                                                                                                                                                                                                                                                             |
| autoFocus                    | `boolean \| string` <br/> Whether focus should be set on a child element once the dialog is open. If `true` focus will be set to the first focusable element inside the dialog content. If a `string` (query selector) is provided focus will be set to the target element.                                                                           |
| restoreFocus                 | `boolean \| string` <br/> Whether focus should be restored once the dialog close. If `true` focus will be restored to the element that triggered the dialog. If a `string` (query selector) is provided focus will be restored to the target element.                                                                                                 |

### Dialog.Trigger

| Data attribute | Description                      |
| :------------- | :------------------------------- |
| data-expanded  | Present when the dialog is open. |

## Accessibility

### Keyboard Interactions

| Key                               | Description                                                                     |
| :-------------------------------- | :------------------------------------------------------------------------------ |
| <Kbd>Space</Kbd>                  | When focus is on the trigger, opens/closes the dialog.                          |
| <Kbd>Enter</Kbd>                  | When focus is on the trigger, opens/closes the dialog.                          |
| <Kbd>Tab</Kbd>                    | When focus is in the content, moves focus to the next focusable element.        |
| <Kbd>Shift</Kbd> + <Kbd>Tab</Kbd> | When focus is in the content, moves focus to the previous focusable element.    |
| <Kbd>Esc</Kbd>                    | When focus is in the content, closes the dialog and moves focus to the trigger. |
